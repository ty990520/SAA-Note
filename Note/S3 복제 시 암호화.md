## S3 복제 시 암호화

1. **S3 복제**:  Amazon S3에서 한 버킷의 데이터를 다른 버킷으로 자동으로 복사하는 기능입니다.

<br>

2. **S3의 서버 측 암호화 방식**:
    - **SSE-S3 (Server-Side Encryption with Amazon S3 Managed Keys)**
        - S3에서 자동으로 생성 및 관리하는 키로 데이터를 암호화합니다.
        - AWS가 키를 관리하므로 복제 시 특별한 처리 없이 그대로 복제됩니다.
    - **SSE-C (Server-Side Encryption with Customer-Provided Keys)**
        - 사용자가 제공하는 키로 데이터를 암호화합니다.
        - 데이터를 업로드하거나 다운로드할 때마다 해당 키를 제공해야 합니다.
        - 이 키는 AWS에 저장되지 않고, 매 요청마다 제공해야함
        - 사용자가 키를 제공하므로, 복제할 때 해당 키를 제공해야 합니다. 이런 자동화된 복제에서는 그렇게 할 수 없기 때문에, SSE-C로 암호화된 객체는 복제되지 않습니다.
    - **SSE-KMS (Server-Side Encryption with AWS KMS)**
        - KMS에서 제공하는 키로 데이터를 암호화합니다.
        - AWS KMS 서비스를 통해 암호화 키를 관리합니다. 이 방식으로 암호화된 객체를 복제하려면 추가 설정과 권한이 필요합니다.
 

<br>

3. **SSE-KMS로 복제하려면**:
   - 기본적으로 복제되지 않지만 만약 객체를 복제하려면 옵션을 활성화해야합니다.
   - 복제하려는 대상 버킷에 어떤 KMS 키로 암호화할 것인지 지정해야 합니다.
   - 이 KMS 키에는 S3 복제를 위한 권한 설정이 필요합니다.
       - KMS 키 정책을 타겟 KMS 키에 적용
       - S3 복제 서비스를 허용하는 IAM 역할을 생성 
   - 복제 과정에서 데이터는 먼저 복호화되고, 그 다음 대상 버킷의 KMS 키로 다시 암호화됩니다.

<br>

4. **다중 리전 KMS 키와 S3 복제**:
   - Amazon S3에서 객체를 다른 리전으로 복제할 때, KMS로 암호화된 객체에 대해서는 복호화 및 재암호화 과정이 발생합니다.
   - 멀티 리전 KMS 키를 사용한다 하더라도, S3는 그 키를 독립적인 (싱글 리전) 키처럼 취급합니다.
   - 따라서, 복제될 객체는 복호화되고, 대상 리전에서 동일한 멀티 리전 KMS 키로 다시 암호화됩니다.
   - 멀티 리전 KMS 키를 사용하더라도 싱글 리전 KMS 키를 사용하는 것과 마찬가지로 복호화 및 재암호화가 필요하므로 멀티 리전 KMS 키의 사용이 KMS 스로틀링 오류의 발생 가능성을 제거해주지는 않습니다.
