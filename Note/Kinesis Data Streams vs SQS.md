## Amazon Kinesis Data Streams와 Amazon SQS의 사용 케이스 비교

**Q: Amazon Kinesis Data Streams와 Amazon SQS를 언제 사용해야 하나요?**

**Amazon Kinesis Data Streams 사용 권장 사례:**

- **동일한 레코드 프로세서로 라우팅 관련 레코드**: 예를 들어, 레코드가 동일한 레코드 프로세서로 라우팅되어야 할 때나, (스트리밍 MapReduce와 같이) 집계와 관련된 작업 등.
  
- **레코드 순서**: 예를 들어, 애플리케이션 호스트에서 처리/보관 호스트로 로그 데이터를 전송하면서 로그 문의 순서를 유지해야 할 때.

- **동일한 스트림을 `동시에 여러 애플리케이션에서` 소비**: 예를 들어, 실시간 대시보드를 업데이트하는 애플리케이션과 Amazon Redshift에 데이터를 보관하는 애플리케이션 모두 동일한 스트림에서 독립적으로 데이터를 소비해야 할 때.
  - Kinesis Data Streams는 여러 애플리케이션들이 동시에 하나의 데이터 스트림을 소비하는 것을 지원합니다. 이는 실시간 분석, 모니터링, 다른 데이터 스토리지나 처리 시스템으로의 데이터 전송과 같은 다양한 작업을 동시에 수행하게 해줍니다. 예를 들어, 실시간으로 데이터 대시보드를 업데이트하는 애플리케이션과 함께 동일한 데이터 스트림을 Amazon Redshift나 다른 데이터 웨어하우스로 보내는 작업을 동시에 수행할 수 있습니다.
- **몇 시간 후에도 `동일한 순서`로 레코드 소비**: 예를 들어, 청구 애플리케이션과 몇 시간 후의 감사 애플리케이션이 있을 때. Amazon Kinesis Data Streams는 최대 7일 동안 데이터를 저장하므로, 청구 애플리케이션 뒤에 최대 7일까지 감사 애플리케이션을 실행할 수 있습니다.
  - Kinesis Data Streams는 입력된 데이터를 최대 7일 동안 보관합니다. 이러한 데이터 보존 기능 덕분에, 데이터 소비자는 레코드를 처음 수신했을 때와 동일한 순서로 나중에 다시 데이터를 소비할 수 있습니다. 이는 오류 복구, 데이터 재처리, 늦게 도착한 데이터 처리와 같은 시나리오에서 유용합니다. 

**Amazon SQS 사용 권장 사례:**

- **메시징 의미론 (메시지 레벨 ack/fail 및 `가시성 타임아웃`)**: 예를 들어, 작업 큐가 있고 각 항목의 완료를 독립적으로 추적하고 싶을 때. Amazon SQS는 ack/fail을 추적하고, 설정된 가시성 타임아웃 후에 실패한 메시지를 재전송합니다.
  - Amazon SQS는 각 메시지에 대한 처리 상태를 추적하기 위한 메시지 수준의 확인 (ack) 및 실패 (fail) 의미론을 제공합니다. 'Visibility Timeout'은 메시지가 처리되는 동안 다른 소비자에게는 보이지 않게 설정하는 시간입니다. 만약 메시지가 설정된 타임아웃 내에 성공적으로 처리되지 않으면, SQS는 해당 메시지를 다시 큐에 넣어 다른 소비자가 처리할 수 있게 합니다. 
- **개별 메시지 지연**: 예를 들어, 작업 큐가 있고 개별 작업을 지연시켜 예약하고 싶을 때. Amazon SQS를 사용하면 최대 15분까지 메시지를 지연시킬 수 있습니다.

- **실시간으로 `동시성/처리량` 증가**: 예를 들어, 백로그를 지우기 위해 더 많은 리더를 추가하고 싶을 때. Amazon Kinesis Data Streams를 사용하면 적절한 수의 샤드로 충분히 확장할 수 있습니다. 
  - 특정 상황에서 처리량이나 동시성을 증가시키는 것이 필요할 때, SQS와 Kinesis Data Streams 모두 동적으로 확장될 수 있습니다. 예를 들어, 큰 데이터 백로그가 발생했을 때, Kinesis는 추가적인 샤드를 통해 스트리밍 데이터의 처리량을 증가시킬 수 있고, SQS는 더 많은 메시지 처리자(예: 더 많은 작업자 또는 EC2 인스턴스)를 추가함으로써 동시성을 증가시킬 수 있습니다.
    - **백로그 (Backlog)** : 백로그는 처리되지 않은 데이터나 메시지의 누적을 말합니다. 즉, 아직 처리되지 않아 대기 중인 데이터의 양을 의미합니다.
    - **샤드 (Shard)** : 샤드는 데이터를 스트리밍하는 데 사용되는 Kinesis Data Streams의 기본 데이터 단위입니다. 각 샤드는 일정량의 데이터를 처리할 수 있는 능력을 가집니다. (N개의 샤드가 있으면 N개의 병렬 처리가 가능)
    - 만약 너무 많은 데이터가 빠르게 들어와서 처리를 따라잡지 못한다면, 그 누적된 대기 데이터를 '백로그'라고 합니다. Kinesis Data Streams에서는 이런 상황을 해결하기 위해 '샤드'라는 데이터 단위를 더 추가할 수 있습니다. 샤드를 추가하면, 동시에 더 많은 데이터를 처리할 수 있게 됩니다. 
    - SQS에서는 데이터 처리 속도를 높이기 위해 메시지를 처리하는 작업자나 서버(EC2 인스턴스)의 수를 늘릴 수 있습니다. 이렇게 하면 큐에 있는 여러 메시지들이 여러 개의 다른 컨슈머에 의해 동시에 처리할 수 있게 됩니다.

- **무프로비저닝으로 투명하게 확장 가능한 Amazon SQS의 능력 활용**: 예를 들어, 버퍼 요청 및 부하 변경 결과로 발생하는 일반적인 부하 스파이크 또는 비즈니스 성장. 버퍼된 각 요청은 독립적으로 처리될 수 있으므로, Amazon SQS는 사용자의 지시 없이 부하를 처리하기 위해 투명하게 확장할 수 있습니다.

